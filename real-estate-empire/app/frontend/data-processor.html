<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Data Processor - Real Estate Empire</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles/data-processor.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <header class="bg-primary text-white p-3 mb-4">
            <div class="row align-items-center">
                <div class="col">
                    <h1><i class="fas fa-robot me-2"></i>AI Data Processor</h1>
                    <p class="mb-0">Upload ZIP files and let AI reformat your data for ML training</p>
                </div>
                <div class="col-auto">
                    <button class="btn btn-outline-light" onclick="showHelp()">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                </div>
            </div>
        </header>

        <div class="row">
            <!-- Upload Section -->
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-upload me-2"></i>Upload & Process</h5>
                    </div>
                    <div class="card-body">
                        <!-- File Upload -->
                        <div class="mb-3">
                            <label for="zipFile" class="form-label">Select ZIP File</label>
                            <input type="file" class="form-control" id="zipFile" accept=".zip" onchange="handleFileSelect(event)">
                            <div class="form-text">Supported formats inside ZIP: CSV, Excel, JSON, TSV, TXT</div>
                        </div>

                        <!-- Processing Mode -->
                        <div class="mb-3">
                            <label class="form-label">Processing Mode</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="processingMode" id="autoMode" value="auto" checked>
                                <label class="form-check-label" for="autoMode">
                                    <strong>Auto Format</strong> - Let AI determine the best ML format
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="processingMode" id="schemaMode" value="schema">
                                <label class="form-check-label" for="schemaMode">
                                    <strong>Custom Schema</strong> - Provide target ML schema
                                </label>
                            </div>
                        </div>

                        <!-- Custom Schema Input -->
                        <div id="schemaInput" class="mb-3" style="display: none;">
                            <label for="targetSchema" class="form-label">Target ML Schema (JSON)</label>
                            <textarea class="form-control" id="targetSchema" rows="8" placeholder='{"fields": {"price": {"type": "float", "required": true}, "bedrooms": {"type": "int"}}, "target_variable": "price"}'></textarea>
                            <div class="form-text">
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="loadSampleSchema()">
                                    Load Sample Schema
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-info" onclick="validateSchema()">
                                    Validate Schema
                                </button>
                            </div>
                        </div>

                        <!-- Process Button -->
                        <button id="processBtn" class="btn btn-primary btn-lg w-100" onclick="processFile()" disabled>
                            <i class="fas fa-cogs me-2"></i>Process with AI
                        </button>

                        <!-- Progress Bar -->
                        <div id="progressContainer" class="mt-3" style="display: none;">
                            <div class="progress">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                            <div id="progressText" class="text-center mt-2">Processing...</div>
                        </div>
                    </div>
                </div>

                <!-- File Preview -->
                <div id="filePreview" class="card" style="display: none;">
                    <div class="card-header">
                        <h6><i class="fas fa-eye me-2"></i>File Preview</h6>
                    </div>
                    <div class="card-body">
                        <div id="fileInfo"></div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="col-lg-6">
                <!-- Processing Results -->
                <div id="resultsContainer" class="card mb-4" style="display: none;">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-chart-line me-2"></i>Processing Results</h5>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" onclick="showTab('summary')">Summary</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="showTab('data')">Data</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="showTab('ai')">AI Analysis</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Summary Tab -->
                        <div id="summaryTab" class="result-tab">
                            <div id="processingReport"></div>
                        </div>

                        <!-- Data Tab -->
                        <div id="dataTab" class="result-tab" style="display: none;">
                            <div id="dataPreview"></div>
                        </div>

                        <!-- AI Analysis Tab -->
                        <div id="aiTab" class="result-tab" style="display: none;">
                            <div id="aiAnalysis"></div>
                        </div>
                    </div>
                </div>

                <!-- Export Options -->
                <div id="exportContainer" class="card" style="display: none;">
                    <div class="card-header">
                        <h6><i class="fas fa-download me-2"></i>Export Processed Data</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4">
                                <button class="btn btn-success w-100" onclick="exportData('csv')">
                                    <i class="fas fa-file-csv me-1"></i>CSV
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-info w-100" onclick="exportData('json')">
                                    <i class="fas fa-file-code me-1"></i>JSON
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-warning w-100" onclick="exportData('excel')">
                                    <i class="fas fa-file-excel me-1"></i>Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessages" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050;"></div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">AI Data Processor Help</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6>How it works:</h6>
                    <ol>
                        <li><strong>Upload ZIP File:</strong> Select a ZIP file containing your data files</li>
                        <li><strong>Choose Processing Mode:</strong>
                            <ul>
                                <li><strong>Auto Format:</strong> AI analyzes your data and suggests the best ML format</li>
                                <li><strong>Custom Schema:</strong> Provide a specific target schema for your ML model</li>
                            </ul>
                        </li>
                        <li><strong>AI Processing:</strong> Gemini AI analyzes and reformats your data</li>
                        <li><strong>Review Results:</strong> Check the processing report and AI recommendations</li>
                        <li><strong>Export:</strong> Download the processed data in your preferred format</li>
                    </ol>

                    <h6>Supported File Types:</h6>
                    <ul>
                        <li>CSV (.csv)</li>
                        <li>Excel (.xlsx, .xls)</li>
                        <li>JSON (.json)</li>
                        <li>Tab-separated (.tsv)</li>
                        <li>Text files (.txt)</li>
                    </ul>

                    <h6>Sample Schema Format:</h6>
                    <pre><code>{
  "fields": {
    "price": {"type": "float", "required": true},
    "bedrooms": {"type": "int"},
    "bathrooms": {"type": "float"},
    "square_feet": {"type": "int"},
    "location": {"type": "string"}
  },
  "target_variable": "price",
  "ml_task": "regression"
}</code></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/data-processor.js"></script>
</body>
</html>